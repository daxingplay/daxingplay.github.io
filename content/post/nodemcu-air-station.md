---
title: "用 NodeMCU 打造自己的空气检测站"
slug: nodemcu-air-station
date: 2018-02-01T22:24:46+08:00
draft: true
---

进入冬天之后，空气质量经常各种爆表，所以我也开始关注起家里空气质量了。最简单的做法就是买个好点的空气净化器嘛，保证家里的 PM2.5 浓度不至于过高。但窗户就不能经常开了，不然岂不是在过滤外面的空气？不开窗户的话，家里的二氧化碳浓度就很容易爆表了，就会造成头脑昏沉等其它影响。

所以，如果有个新风系统能换气就好了。对于我家来说，万科给装的兰舍负压新风，现在已经在兰舍官网上查不到了。简单的说，这个新风系统就是把家里的空气抽出去，形成负压，那么空气就会从外部，比如窗缝、门缝，以及兰舍新风在各个房间上的进气口（要手动打开，只是个盖子），进入房间内部，完成换气过程。

推开这种新风的原理等等不说，起码这个新风是没有除霾功能的，毕竟你看空气进入的方式就知道了。我总不能在窗缝门缝上装滤芯吧，那个进气口就更别说了，定制起来肯定很麻烦。也更别提热交换什么功能了，我觉得就可以理解为排气扇。

虽然这个负压新风被我说的这么不堪，但起码还是有点换气作用的，虽然换气效率极低，所以我的计划是把这个新风接入智能家居系统，然后通过检测家里的二氧化碳浓度以及是否开了空调等，决定是否打开新风系统进行换气。

那怎么检测家里的二氧化碳浓度和 PM2.5 等呢？最简单的，我们可以去淘宝上买现成的空气检测仪，或者 DIY 好的空气检测装置，一般还带个屏幕啥的，但就不太好接自己家的 Home Assistant 系统了。所以我们就自己 DIY 一个呗。

方案我也是网上各种搜来的，基本上需要的硬件是：

* NodeMCU：很好用的开发板，基于 ESP8266，集成了 Micro USB 输入，4M Flash，开发时使用起来更方便。开发语言是 Lua，对于前端来说上手很容易
* 攀藤：大名鼎鼎的空气质量传感器，据说小米的空气净化器也是用的这个，网上 DIY 的基本都是用的这个。
* SenseAir S8：瑞士生产的二氧化碳浓度传感器，有不同量程的，我买的是最便宜的，量程是 400ppm 起的。但也不便宜。还有个国产的是 MH-Z19，会便宜一些。

这些硬件淘宝很容易买到。

Mac 系统下需要安装驱动，我在网上找了三个：

* [CH341SER_MAC.zip](/files/nodemcu-air-station/CH341SER_MAC.zip)
* [CH34x_Install_MAC_10_9_AND_ABOVE_V1_3.zip](/files/nodemcu-air-station/CH34x_Install_MAC_10_9_AND_ABOVE_V1_3.zip)
* [Mac_OSX_VCP_Driver.zip](/files/nodemcu-air-station/Mac_OSX_VCP_Driver.zip)

这三个应该都是可以的，可以自己试一试。第一个和第二个应该是一样的，我应该是用了这两个中的一个。唯一的区别可能是最后刷机的时候 port 的不同。

```
esptool.py --port /dev/cu.wchusbserial1420 write_flash -fm dio 0x00000 /path-to-nodemcu.bin
```